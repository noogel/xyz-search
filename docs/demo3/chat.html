<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI对话 - 智能检索平台</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  <!-- 导入页头 -->
  <div id="header-container"></div>
  
  <!-- 主要内容 -->
  <main class="flex-grow pt-20 pb-0">
    <div class="flex h-[calc(100vh-80px)]">
      <!-- 侧边栏 - 聊天历史记录 -->
      <div class="w-64 bg-white border-r border-gray-200 flex flex-col h-full hidden md:block">
        <div class="p-4 border-b border-gray-200">
          <button id="new-chat-btn" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 flex items-center justify-center">
            <i class="fas fa-plus mr-2"></i>
            新建对话
          </button>
        </div>
        
        <div class="flex-1 overflow-y-auto p-2">
          <div class="space-y-1">
            <a href="#" class="block p-2 rounded-lg bg-blue-50 border border-blue-100 text-blue-800">
              <div class="text-sm font-medium truncate">文档分析讨论</div>
              <div class="text-xs text-gray-500 truncate mt-1">今天</div>
            </a>
            
            <a href="#" class="block p-2 rounded-lg hover:bg-gray-100">
              <div class="text-sm font-medium truncate">项目规划</div>
              <div class="text-xs text-gray-500 truncate mt-1">昨天</div>
            </a>
            
            <a href="#" class="block p-2 rounded-lg hover:bg-gray-100">
              <div class="text-sm font-medium truncate">市场分析报告</div>
              <div class="text-xs text-gray-500 truncate mt-1">3天前</div>
            </a>
            
            <a href="#" class="block p-2 rounded-lg hover:bg-gray-100">
              <div class="text-sm font-medium truncate">产品功能讨论</div>
              <div class="text-xs text-gray-500 truncate mt-1">上周</div>
            </a>
            
            <a href="#" class="block p-2 rounded-lg hover:bg-gray-100">
              <div class="text-sm font-medium truncate">客户需求分析</div>
              <div class="text-xs text-gray-500 truncate mt-1">2023/07/15</div>
            </a>
          </div>
        </div>
        
        <div class="p-3 border-t border-gray-200">
          <div class="flex items-center">
            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="用户头像" class="h-8 w-8 rounded-full mr-2">
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-gray-900 truncate">张三</p>
              <p class="text-xs text-gray-500 truncate">zhangsan@example.com</p>
            </div>
            <button class="text-gray-400 hover:text-gray-600">
              <i class="fas fa-cog"></i>
            </button>
          </div>
        </div>
      </div>
      
      <!-- 主聊天区域 -->
      <div class="flex-1 flex flex-col h-full overflow-hidden bg-gray-50">
        <!-- 聊天头部 -->
        <div class="bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between">
          <div class="flex items-center">
            <button id="mobile-sidebar-toggle" class="md:hidden text-gray-500 mr-3">
              <i class="fas fa-bars"></i>
            </button>
            <h1 class="text-lg font-semibold text-gray-900">文档分析讨论</h1>
          </div>
          
          <div class="flex items-center space-x-3">
            <button class="text-gray-500 hover:text-blue-600" title="分享对话">
              <i class="fas fa-share-alt"></i>
            </button>
            <button class="text-gray-500 hover:text-blue-600" title="保存对话">
              <i class="fas fa-save"></i>
            </button>
            <button class="text-gray-500 hover:text-blue-600" title="更多选项">
              <i class="fas fa-ellipsis-v"></i>
            </button>
          </div>
        </div>
        
        <!-- 文件上下文选择 -->
        <div class="bg-white border-b border-gray-200 px-4 py-2">
          <div class="flex items-center">
            <span class="text-sm text-gray-600 mr-2">关联文档:</span>
            <div class="flex items-center space-x-2 overflow-x-auto pb-1">
              <div class="inline-flex items-center bg-blue-50 border border-blue-200 rounded-full px-3 py-1 text-xs text-blue-800">
                <i class="far fa-file-pdf text-red-500 mr-1"></i>
                <span class="truncate max-w-[120px]">2023年Q2季度财务报表.pdf</span>
                <button class="ml-1 text-gray-400 hover:text-gray-600">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              
              <button class="inline-flex items-center bg-gray-100 hover:bg-gray-200 rounded-full px-3 py-1 text-xs text-gray-700">
                <i class="fas fa-plus mr-1"></i>
                添加文档
              </button>
            </div>
          </div>
        </div>
        
        <!-- 聊天内容区域 -->
        <div class="flex-1 overflow-y-auto p-4 space-y-6" id="chat-messages">
          <!-- 系统消息 -->
          <div class="flex justify-center">
            <div class="bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full">
              今天 14:32
            </div>
          </div>
          
          <!-- AI消息 -->
          <div class="flex items-start">
            <div class="flex-shrink-0 mr-3">
              <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                <i class="fas fa-robot"></i>
              </div>
            </div>
            <div class="flex-1 max-w-3xl">
              <div class="bg-white rounded-lg shadow-sm p-4 chat-bubble-ai">
                <p class="text-gray-800">欢迎使用智能检索平台的AI对话功能。我可以帮助您分析文档内容，回答问题，或提供相关建议。您可以直接提问，也可以上传文档让我基于文档内容回答问题。</p>
                <p class="text-gray-800 mt-2">有什么我可以帮助您的吗？</p>
              </div>
              <div class="flex items-center mt-1 text-xs text-gray-500 space-x-2">
                <button class="hover:text-blue-600">
                  <i class="far fa-thumbs-up"></i>
                </button>
                <button class="hover:text-blue-600">
                  <i class="far fa-thumbs-down"></i>
                </button>
                <button class="hover:text-blue-600">
                  <i class="far fa-copy"></i> 复制
                </button>
              </div>
            </div>
          </div>
          
          <!-- 用户消息 -->
          <div class="flex items-start justify-end">
            <div class="flex-1 max-w-3xl">
              <div class="bg-blue-600 text-white rounded-lg shadow-sm p-4 chat-bubble-user">
                <p>请帮我分析一下上传的财务报表中第二季度的销售表现，并指出其中的关键点和潜在问题。</p>
              </div>
            </div>
            <div class="flex-shrink-0 ml-3">
              <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="用户头像" class="w-8 h-8 rounded-full">
            </div>
          </div>
          
          <!-- AI消息 带引用 -->
          <div class="flex items-start">
            <div class="flex-shrink-0 mr-3">
              <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                <i class="fas fa-robot"></i>
              </div>
            </div>
            <div class="flex-1 max-w-3xl">
              <div class="bg-white rounded-lg shadow-sm p-4 chat-bubble-ai">
                <p class="text-gray-800">根据您上传的2023年Q2季度财务报表，我对销售表现进行了以下分析：</p>
                
                <div class="border-l-4 border-blue-300 pl-3 my-3 text-sm text-gray-600 bg-blue-50 p-2 rounded">
                  <p class="font-medium">引用自: 2023年Q2季度财务报表.pdf (第12页)</p>
                  <p class="mt-1">"第二季度销售总额达到￥3,240万元，较上一季度增长15.3%，较去年同期增长8.2%..."</p>
                </div>
                
                <h4 class="font-semibold text-gray-900 mt-3">关键亮点：</h4>
                <ul class="list-disc pl-5 mt-1 space-y-1 text-gray-800">
                  <li>销售额较上季度显著增长15.3%，表现优于市场平均水平</li>
                  <li>新产品线贡献了约22%的季度收入，显示产品创新策略有效</li>
                  <li>线上渠道销售额首次超过线下渠道，增长了27%</li>
                </ul>
                
                <h4 class="font-semibold text-gray-900 mt-3">潜在问题：</h4>
                <ul class="list-disc pl-5 mt-1 space-y-1 text-gray-800">
                  <li>传统产品线销售下滑5.7%，可能需要产品更新或营销策略调整</li>
                  <li>华南地区销售额环比下降3.2%，需要调查区域市场变化</li>
                  <li>毛利率从42.8%下降到41.5%，原材料成本上升是主要原因</li>
                </ul>
                
                <p class="text-gray-800 mt-3">建议您关注毛利率下滑趋势，并考虑加强华南地区的市场推广。同时，可以考虑为传统产品线制定更新计划，以保持整体产品组合的竞争力。</p>
                
                <p class="text-gray-800 mt-3">您是否需要我对某个具体问题进行更深入的分析？</p>
              </div>
              <div class="flex items-center mt-1 text-xs text-gray-500 space-x-2">
                <button class="hover:text-blue-600">
                  <i class="far fa-thumbs-up"></i>
                </button>
                <button class="hover:text-blue-600">
                  <i class="far fa-thumbs-down"></i>
                </button>
                <button class="hover:text-blue-600">
                  <i class="far fa-copy"></i> 复制
                </button>
              </div>
            </div>
          </div>
          
          <!-- 用户消息 -->
          <div class="flex items-start justify-end">
            <div class="flex-1 max-w-3xl">
              <div class="bg-blue-600 text-white rounded-lg shadow-sm p-4 chat-bubble-user">
                <p>请进一步分析毛利率下降的具体原因，并提供一些改善建议。</p>
              </div>
            </div>
            <div class="flex-shrink-0 ml-3">
              <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="用户头像" class="w-8 h-8 rounded-full">
            </div>
          </div>
          
          <!-- AI消息 带代码 -->
          <div class="flex items-start">
            <div class="flex-shrink-0 mr-3">
              <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                <i class="fas fa-robot"></i>
              </div>
            </div>
            <div class="flex-1 max-w-3xl">
              <div class="bg-white rounded-lg shadow-sm p-4 chat-bubble-ai">
                <p class="text-gray-800">根据报表中的财务数据，我进一步分析了毛利率下降的具体原因：</p>
                
                <div class="border-l-4 border-blue-300 pl-3 my-3 text-sm text-gray-600 bg-blue-50 p-2 rounded">
                  <p class="font-medium">引用自: 2023年Q2季度财务报表.pdf (第18页)</p>
                  <p class="mt-1">"成本构成分析显示，原材料成本上升12.3%，物流成本上升7.8%，是导致整体毛利率下降的主要因素..."</p>
                </div>
                
                <h4 class="font-semibold text-gray-900 mt-3">毛利率下降的主要原因：</h4>
                <ol class="list-decimal pl-5 mt-1 space-y-1 text-gray-800">
                  <li><strong>原材料成本上升 (12.3%)</strong>：主要是由于全球供应链紧张和部分关键原材料价格上涨</li>
                  <li><strong>物流成本增加 (7.8%)</strong>：燃油价格上涨和运输效率下降导致</li>
                  <li><strong>产品结构变化</strong>：低毛利率的新产品线占比增加</li>
                  <li><strong>促销活动增加</strong>：为应对市场竞争，增加了促销力度</li>
                </ol>
                
                <p class="text-gray-800 mt-3">从数据来看，成本增加对毛利率的影响可以用以下图表表示：</p>
                
                <pre class="bg-gray-50 p-3 rounded-md text-sm mt-2 overflow-auto"><code class="language-javascript">// 毛利率影响因素分析图表示例
const chart = new Chart(ctx, {
  type: 'waterfall',
  data: {
    labels: ['上季毛利率', '原材料成本', '物流成本', '产品结构', '促销活动', '本季毛利率'],
    datasets: [{
      data: [42.8, -0.7, -0.3, -0.2, -0.1, 41.5],
      backgroundColor: [
        'rgba(54, 162, 235, 0.5)',
        'rgba(255, 99, 132, 0.5)',
        'rgba(255, 99, 132, 0.5)',
        'rgba(255, 99, 132, 0.5)', 
        'rgba(255, 99, 132, 0.5)',
        'rgba(54, 162, 235, 0.5)'
      ],
      borderColor: [
        'rgb(54, 162, 235)',
        'rgb(255, 99, 132)',
        'rgb(255, 99, 132)',
        'rgb(255, 99, 132)',
        'rgb(255, 99, 132)',
        'rgb(54, 162, 235)'
      ],
      borderWidth: 1
    }]
  },
  options: {
    // 配置选项...
  }
});</code></pre>
                
                <h4 class="font-semibold text-gray-900 mt-4">改善建议：</h4>
                <ol class="list-decimal pl-5 mt-1 space-y-2 text-gray-800">
                  <li>
                    <strong>供应链优化</strong>：
                    <ul class="list-disc pl-5 mt-1 text-gray-700">
                      <li>寻找替代原材料供应商，进行比价采购</li>
                      <li>与主要供应商重新谈判长期合同，锁定价格</li>
                      <li>增加原材料库存策略，在低价时适当增加储备</li>
                    </ul>
                  </li>
                  <li>
                    <strong>物流效率提升</strong>：
                    <ul class="list-disc pl-5 mt-1 text-gray-700">
                      <li>整合运输路线，提高配送效率</li>
                      <li>考虑使用区域仓储，减少长距离运输</li>
                      <li>引入物流管理系统，优化配送路径</li>
                    </ul>
                  </li>
                  <li>
                    <strong>产品结构调整</strong>：
                    <ul class="list-disc pl-5 mt-1 text-gray-700">
                      <li>对低毛利产品进行成本重新评估</li>
                      <li>加大高毛利产品的营销力度</li>
                      <li>考虑逐步淘汰毛利过低的产品线</li>
                    </ul>
                  </li>
                  <li>
                    <strong>精准营销</strong>：
                    <ul class="list-disc pl-5 mt-1 text-gray-700">
                      <li>减少全面促销，转向精准客户定向优惠</li>
                      <li>开发会员体系，提高客户忠诚度</li>
                      <li>通过数据分析，优化促销策略和投入产出比</li>
                    </ul>
                  </li>
                </ol>
                
                <p class="text-gray-800 mt-3">根据报表中的数据，如果能有效实施以上建议，预计可以在下一季度将毛利率提升1-1.5个百分点。您是否希望我对某个具体建议提供更详细的实施计划？</p>
              </div>
              <div class="flex items-center mt-1 text-xs text-gray-500 space-x-2">
                <button class="hover:text-blue-600">
                  <i class="far fa-thumbs-up"></i>
                </button>
                <button class="hover:text-blue-600">
                  <i class="far fa-thumbs-down"></i>
                </button>
                <button class="hover:text-blue-600">
                  <i class="far fa-copy"></i> 复制
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 输入区域 -->
        <div class="bg-white border-t border-gray-200 p-4">
          <div class="flex items-center">
            <button class="text-gray-500 hover:text-blue-600 mr-2" title="上传文件">
              <i class="fas fa-paperclip"></i>
            </button>
            <div class="flex-1 relative">
              <textarea id="message-input" rows="1" placeholder="输入您的问题..." class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none overflow-hidden"></textarea>
              <button class="absolute right-3 top-2 text-gray-400 hover:text-gray-600">
                <i class="fas fa-microphone"></i>
              </button>
            </div>
            <button id="send-button" class="ml-2 px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
          <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
            <div>
              <span>AI模型: GPT-4</span>
              <button class="ml-1 text-blue-600 hover:underline">更改</button>
            </div>
            <div>
              <button class="hover:text-blue-600">
                <i class="fas fa-keyboard mr-1"></i> 快捷操作
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 移动端侧边栏 (默认隐藏) -->
      <div id="mobile-sidebar" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden">
        <div class="bg-white w-64 h-full">
          <!-- 移动端侧边栏内容 (复制自常规侧边栏) -->
          <div class="flex items-center justify-between p-4 border-b border-gray-200">
            <h3 class="font-medium text-lg">对话历史</h3>
            <button id="close-mobile-sidebar" class="text-gray-500">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <div class="p-4 border-b border-gray-200">
            <button class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 flex items-center justify-center">
              <i class="fas fa-plus mr-2"></i>
              新建对话
            </button>
          </div>
          
          <div class="overflow-y-auto p-2">
            <div class="space-y-1">
              <a href="#" class="block p-2 rounded-lg bg-blue-50 border border-blue-100 text-blue-800">
                <div class="text-sm font-medium truncate">文档分析讨论</div>
                <div class="text-xs text-gray-500 truncate mt-1">今天</div>
              </a>
              
              <a href="#" class="block p-2 rounded-lg hover:bg-gray-100">
                <div class="text-sm font-medium truncate">项目规划</div>
                <div class="text-xs text-gray-500 truncate mt-1">昨天</div>
              </a>
              
              <a href="#" class="block p-2 rounded-lg hover:bg-gray-100">
                <div class="text-sm font-medium truncate">市场分析报告</div>
                <div class="text-xs text-gray-500 truncate mt-1">3天前</div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <script src="js/main.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 加载页头
      fetch('components/header.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('header-container').innerHTML = data;
          
          // 重新初始化页头JS
          const headerScript = document.createElement('script');
          headerScript.innerHTML = document.getElementById('header-container').querySelector('script').innerHTML;
          document.body.appendChild(headerScript);
        });
      
      // 自动调整文本输入框高度
      const messageInput = document.getElementById('message-input');
      messageInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
      });
      
      // 处理发送按钮状态
      const sendButton = document.getElementById('send-button');
      messageInput.addEventListener('input', function() {
        sendButton.disabled = this.value.trim() === '';
      });
      
      // 初始化代码高亮
      document.querySelectorAll('pre code').forEach((block) => {
        hljs.highlightBlock(block);
      });
      
      // 处理移动端侧边栏
      const mobileSidebarToggle = document.getElementById('mobile-sidebar-toggle');
      const mobileSidebar = document.getElementById('mobile-sidebar');
      const closeMobileSidebar = document.getElementById('close-mobile-sidebar');
      
      mobileSidebarToggle.addEventListener('click', () => {
        mobileSidebar.classList.remove('hidden');
      });
      
      closeMobileSidebar.addEventListener('click', () => {
        mobileSidebar.classList.add('hidden');
      });
      
      // 点击侧边栏外部关闭
      mobileSidebar.addEventListener('click', (e) => {
        if (e.target === mobileSidebar) {
          mobileSidebar.classList.add('hidden');
        }
      });
      
      // 处理消息发送
      sendButton.addEventListener('click', sendMessage);
      messageInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });
      
      function sendMessage() {
        const message = messageInput.value.trim();
        if (!message) return;
        
        // 添加用户消息
        const chatMessages = document.getElementById('chat-messages');
        const userMessage = `
          <div class="flex items-start justify-end">
            <div class="flex-1 max-w-3xl">
              <div class="bg-blue-600 text-white rounded-lg shadow-sm p-4 chat-bubble-user">
                <p>${message}</p>
              </div>
            </div>
            <div class="flex-shrink-0 ml-3">
              <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="用户头像" class="w-8 h-8 rounded-full">
            </div>
          </div>
        `;
        
        chatMessages.innerHTML += userMessage;
        messageInput.value = '';
        messageInput.style.height = 'auto';
        sendButton.disabled = true;
        
        // 滚动到底部
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // 显示AI正在输入状态
        setTimeout(() => {
          const typingIndicator = `
            <div id="typing-indicator" class="flex items-start">
              <div class="flex-shrink-0 mr-3">
                <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                  <i class="fas fa-robot"></i>
                </div>
              </div>
              <div class="flex-1 max-w-3xl">
                <div class="bg-white rounded-lg shadow-sm p-4 chat-bubble-ai">
                  <div class="flex space-x-2">
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
                  </div>
                </div>
              </div>
            </div>
          `;
          
          chatMessages.innerHTML += typingIndicator;
          chatMessages.scrollTop = chatMessages.scrollHeight;
          
          // 模拟AI回复
          simulateAIResponse(message);
        }, 500);
      }
      
      function simulateAIResponse(message) {
        // 这里是模拟AI响应，实际应用中应该调用后端API
        setTimeout(() => {
          const chatMessages = document.getElementById('chat-messages');
          const typingIndicator = document.getElementById('typing-indicator');
          if (typingIndicator) {
            typingIndicator.remove();
          }
          
          let aiResponse = '';
          
          // 根据用户消息内容生成不同的回复
          if (message.toLowerCase().includes('介绍') || message.toLowerCase().includes('说明')) {
            aiResponse = `
              <div class="flex items-start">
                <div class="flex-shrink-0 mr-3">
                  <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                    <i class="fas fa-robot"></i>
                  </div>
                </div>
                <div class="flex-1 max-w-3xl">
                  <div class="bg-white rounded-lg shadow-sm p-4 chat-bubble-ai">
                    <p class="text-gray-800">我是智能检索平台的AI助手，可以帮助您:</p>
                    <ul class="list-disc pl-5 mt-2 space-y-1 text-gray-800">
                      <li>分析上传的文档内容</li>
                      <li>回答关于文档的具体问题</li>
                      <li>提供相关资料和建议</li>
                      <li>生成报告和摘要</li>
                    </ul>
                    <p class="text-gray-800 mt-2">您可以在对话中随时上传新的文档，或者切换到其他已上传的文档进行分析。</p>
                  </div>
                  <div class="flex items-center mt-1 text-xs text-gray-500 space-x-2">
                    <button class="hover:text-blue-600">
                      <i class="far fa-thumbs-up"></i>
                    </button>
                    <button class="hover:text-blue-600">
                      <i class="far fa-thumbs-down"></i>
                    </button>
                    <button class="hover:text-blue-600">
                      <i class="far fa-copy"></i> 复制
                    </button>
                  </div>
                </div>
              </div>
            `;
          } else {
            aiResponse = `
              <div class="flex items-start">
                <div class="flex-shrink-0 mr-3">
                  <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                    <i class="fas fa-robot"></i>
                  </div>
                </div>
                <div class="flex-1 max-w-3xl">
                  <div class="bg-white rounded-lg shadow-sm p-4 chat-bubble-ai">
                    <p class="text-gray-800">感谢您的提问。根据您关联的文档内容，我找到了以下相关信息：</p>
                    
                    <div class="border-l-4 border-blue-300 pl-3 my-3 text-sm text-gray-600 bg-blue-50 p-2 rounded">
                      <p class="font-medium">引用自: 2023年Q2季度财务报表.pdf</p>
                      <p class="mt-1">这里是从文档中提取的相关内容...</p>
                    </div>
                    
                    <p class="text-gray-800 mt-3">基于这些信息，我的分析如下：</p>
                    <ol class="list-decimal pl-5 mt-1 space-y-1 text-gray-800">
                      <li>这是第一个分析点...</li>
                      <li>这是第二个分析点...</li>
                      <li>这是第三个分析点...</li>
                    </ol>
                    
                    <p class="text-gray-800 mt-3">您对这个分析有什么疑问，或者需要我进一步详细解释其中的某个方面吗？</p>
                  </div>
                  <div class="flex items-center mt-1 text-xs text-gray-500 space-x-2">
                    <button class="hover:text-blue-600">
                      <i class="far fa-thumbs-up"></i>
                    </button>
                    <button class="hover:text-blue-600">
                      <i class="far fa-thumbs-down"></i>
                    </button>
                    <button class="hover:text-blue-600">
                      <i class="far fa-copy"></i> 复制
                    </button>
                  </div>
                </div>
              </div>
            `;
          }
          
          chatMessages.innerHTML += aiResponse;
          chatMessages.scrollTop = chatMessages.scrollHeight;
          
          // 重新初始化代码高亮
          document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightBlock(block);
          });
        }, 2000);
      }
      
      // 新建对话按钮
      const newChatBtn = document.getElementById('new-chat-btn');
      newChatBtn.addEventListener('click', () => {
        const chatMessages = document.getElementById('chat-messages');
        // 清空聊天记录
        chatMessages.innerHTML = `
          <!-- 系统消息 -->
          <div class="flex justify-center">
            <div class="bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full">
              新对话开始
            </div>
          </div>
          
          <!-- AI消息 -->
          <div class="flex items-start">
            <div class="flex-shrink-0 mr-3">
              <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                <i class="fas fa-robot"></i>
              </div>
            </div>
            <div class="flex-1 max-w-3xl">
              <div class="bg-white rounded-lg shadow-sm p-4 chat-bubble-ai">
                <p class="text-gray-800">欢迎使用智能检索平台的AI对话功能。我可以帮助您分析文档内容，回答问题，或提供相关建议。您可以直接提问，也可以上传文档让我基于文档内容回答问题。</p>
                <p class="text-gray-800 mt-2">有什么我可以帮助您的吗？</p>
              </div>
              <div class="flex items-center mt-1 text-xs text-gray-500 space-x-2">
                <button class="hover:text-blue-600">
                  <i class="far fa-thumbs-up"></i>
                </button>
                <button class="hover:text-blue-600">
                  <i class="far fa-thumbs-down"></i>
                </button>
                <button class="hover:text-blue-600">
                  <i class="far fa-copy"></i> 复制
                </button>
              </div>
            </div>
          </div>
        `;
        
        // 移动端关闭侧边栏
        if (mobileSidebar) {
          mobileSidebar.classList.add('hidden');
        }
      });
    });
  </script>
</body>
</html> 