<!-- 数据存储配置页面内容 -->
<div class="bg-white rounded-lg shadow-lg overflow-hidden">
    <!-- 数据库连接设置 -->
    <div class="p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">数据库连接设置</h3>
        
        <div class="space-y-6">
            <!-- 数据库类型选择 -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">数据库类型</label>
                <div class="mt-1">
                    <select class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md">
                        <option selected>SQLite</option>
                        <option>MySQL</option>
                        <option>PostgreSQL</option>
                        <option>MongoDB</option>
                    </select>
                </div>
                <p class="mt-1 text-xs text-gray-500">选择系统使用的主数据库类型</p>
            </div>
            
            <!-- 数据库连接信息 -->
            <div id="db-connection-fields" class="space-y-4">
                <!-- SQLite配置 -->
                <div id="sqlite-config">
                    <label class="block text-sm font-medium text-gray-700 mb-1">数据库文件路径</label>
                    <div class="mt-1 flex rounded-md shadow-sm">
                        <div class="relative flex items-stretch flex-grow focus-within:z-10">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-database text-gray-400"></i>
                            </div>
                            <input type="text" value="/data/xyz-search.db" class="focus:ring-primary-500 focus:border-primary-500 block w-full rounded-none rounded-l-md pl-10 sm:text-sm border-gray-300">
                        </div>
                        <button type="button" class="relative inline-flex items-center space-x-2 px-4 py-2 border border-gray-300 text-sm font-medium rounded-r-md text-gray-700 bg-gray-50 hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500">
                            <i class="fas fa-folder-open"></i>
                            <span>浏览</span>
                        </button>
                    </div>
                </div>
                
                <!-- 其他配置字段 (隐藏状态) -->
                <div id="other-db-config" class="hidden space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">主机地址</label>
                            <input type="text" placeholder="localhost" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">端口</label>
                            <input type="text" placeholder="3306" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">数据库名称</label>
                        <input type="text" placeholder="xyz_search" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                            <input type="text" placeholder="root" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                            <input type="password" placeholder="••••••••" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 测试连接按钮 -->
            <div>
                <button type="button" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    <i class="fas fa-plug mr-2"></i>
                    测试数据库连接
                </button>
            </div>
            
            <!-- 数据库连接说明 -->
            <div class="bg-blue-50 rounded-lg p-4 text-sm text-blue-800">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-info-circle text-blue-600"></i>
                    </div>
                    <div class="ml-3">
                        <p>系统默认使用SQLite作为数据库，简单轻量无需额外配置。</p>
                        <p class="mt-2">如果需要更好的并发性能或多实例部署，建议使用MySQL或PostgreSQL。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="border-t border-gray-200"></div>
    
    <!-- 向量存储配置 -->
    <div class="p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">向量存储配置</h3>
        <div class="space-y-6">
            <!-- 向量存储类型 -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">向量存储类型</label>
                <div class="mt-1">
                    <select class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md">
                        <option selected>Chroma (内嵌)</option>
                        <option>Milvus</option>
                        <option>FAISS</option>
                        <option>PGVector</option>
                    </select>
                </div>
                <p class="mt-1 text-xs text-gray-500">选择系统使用的向量数据库类型</p>
            </div>
            
            <!-- Chroma配置 -->
            <div id="chroma-config">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">存储目录</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <div class="relative flex items-stretch flex-grow focus-within:z-10">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-folder text-gray-400"></i>
                                </div>
                                <input type="text" value="/data/chroma_db" class="focus:ring-primary-500 focus:border-primary-500 block w-full rounded-none rounded-l-md pl-10 sm:text-sm border-gray-300">
                            </div>
                            <button type="button" class="relative inline-flex items-center space-x-2 px-4 py-2 border border-gray-300 text-sm font-medium rounded-r-md text-gray-700 bg-gray-50 hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500">
                                <i class="fas fa-folder-open"></i>
                                <span>浏览</span>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">集合名称</label>
                        <input type="text" value="xyz_search_vectors" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                    </div>
                </div>
            </div>
            
            <!-- 其他向量存储配置 (隐藏状态) -->
            <div id="other-vector-config" class="hidden space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">服务地址</label>
                        <input type="text" placeholder="localhost" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">端口</label>
                        <input type="text" placeholder="19530" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">集合名称</label>
                        <input type="text" placeholder="xyz_vectors" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">向量维度</label>
                        <input type="number" value="768" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                        <input type="text" placeholder="root" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                        <input type="password" placeholder="••••••••" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="border-t border-gray-200"></div>
    
    <!-- 缓存设置 -->
    <div class="p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">缓存设置</h3>
        <div class="space-y-6">
            <!-- 缓存启用开关 -->
            <div class="flex items-center">
                <input id="enable-cache" name="enable-cache" type="checkbox" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded" checked>
                <label for="enable-cache" class="ml-2 block text-sm text-gray-900">
                    启用系统缓存
                </label>
            </div>
            
            <!-- 缓存类型选择 -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">缓存类型</label>
                <div class="mt-1">
                    <select class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md">
                        <option selected>内存缓存</option>
                        <option>Redis</option>
                        <option>文件缓存</option>
                    </select>
                </div>
            </div>
            
            <!-- 缓存配置 -->
            <div id="cache-config" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">缓存大小限制 (MB)</label>
                        <input type="number" value="2048" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">缓存过期时间 (秒)</label>
                        <input type="number" value="3600" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                    </div>
                </div>
                
                <!-- Redis配置 (隐藏状态) -->
                <div id="redis-config" class="hidden space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Redis地址</label>
                            <input type="text" placeholder="localhost" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Redis端口</label>
                            <input type="text" placeholder="6379" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">数据库索引</label>
                            <input type="number" value="0" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">密码 (可选)</label>
                            <input type="password" placeholder="••••••••" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 缓存说明 -->
            <div class="bg-yellow-50 rounded-lg p-4 text-sm text-yellow-800">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-lightbulb text-yellow-600"></i>
                    </div>
                    <div class="ml-3">
                        <p>缓存可以显著提高系统响应速度，特别是对于频繁访问的内容。</p>
                        <p class="mt-2">对于生产环境，建议使用Redis缓存以获得更好的性能和可靠性。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 按钮组 -->
    <div class="px-6 py-4 bg-gray-50 flex justify-end space-x-3">
        <button type="button" class="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
            重置
        </button>
        <button type="button" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
            保存设置
        </button>
    </div>
</div>

<script>
    document.addEventListener('settingsTabLoaded', function(e) {
        if (e.detail.tab === 'data-storage') {
            console.log('数据存储配置标签页已加载');
            
            // 处理数据库类型切换
            const dbTypeSelect = document.querySelector('select');
            const sqliteConfig = document.getElementById('sqlite-config');
            const otherDbConfig = document.getElementById('other-db-config');
            
            if (dbTypeSelect && sqliteConfig && otherDbConfig) {
                dbTypeSelect.addEventListener('change', function() {
                    if (this.value === 'SQLite') {
                        sqliteConfig.classList.remove('hidden');
                        otherDbConfig.classList.add('hidden');
                    } else {
                        sqliteConfig.classList.add('hidden');
                        otherDbConfig.classList.remove('hidden');
                    }
                });
            }
            
            // 处理向量存储类型切换
            const vectorTypeSelect = document.querySelectorAll('select')[1];
            const chromaConfig = document.getElementById('chroma-config');
            const otherVectorConfig = document.getElementById('other-vector-config');
            
            if (vectorTypeSelect && chromaConfig && otherVectorConfig) {
                vectorTypeSelect.addEventListener('change', function() {
                    if (this.value === 'Chroma (内嵌)') {
                        chromaConfig.classList.remove('hidden');
                        otherVectorConfig.classList.add('hidden');
                    } else {
                        chromaConfig.classList.add('hidden');
                        otherVectorConfig.classList.remove('hidden');
                    }
                });
            }
            
            // 处理缓存类型切换
            const cacheTypeSelect = document.querySelectorAll('select')[2];
            const redisConfig = document.getElementById('redis-config');
            
            if (cacheTypeSelect && redisConfig) {
                cacheTypeSelect.addEventListener('change', function() {
                    if (this.value === 'Redis') {
                        redisConfig.classList.remove('hidden');
                    } else {
                        redisConfig.classList.add('hidden');
                    }
                });
            }
            
            // 处理缓存启用状态
            const enableCache = document.getElementById('enable-cache');
            const cacheConfig = document.getElementById('cache-config');
            
            if (enableCache && cacheConfig) {
                enableCache.addEventListener('change', function() {
                    // 启用或禁用缓存配置区域
                    const isEnabled = this.checked;
                    cacheConfig.classList.toggle('opacity-50', !isEnabled);
                    
                    // 启用或禁用所有输入字段
                    const inputs = cacheConfig.querySelectorAll('input, select');
                    inputs.forEach(input => {
                        input.disabled = !isEnabled;
                    });
                });
            }
            
            // 处理测试数据库连接按钮点击
            const testDbBtn = document.querySelector('button:has(i.fa-plug)');
            if (testDbBtn) {
                testDbBtn.addEventListener('click', function() {
                    // 显示连接测试中
                    const originalText = this.textContent.trim();
                    this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> 连接中...';
                    this.disabled = true;
                    
                    // 模拟测试过程
                    setTimeout(() => {
                        // 恢复按钮状态
                        this.innerHTML = '<i class="fas fa-plug mr-2"></i> 测试数据库连接';
                        this.disabled = false;
                        
                        // 显示测试结果
                        alert('数据库连接测试成功！');
                    }, 1000);
                });
            }
            
            // 处理浏览按钮点击
            const browseBtns = document.querySelectorAll('button:has(i.fa-folder-open)');
            browseBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const input = this.closest('.flex.rounded-md').querySelector('input');
                    if (input) {
                        alert(`浏览目录: ${input.value}\n此功能正在开发中...`);
                    }
                });
            });
        }
    });
</script> 