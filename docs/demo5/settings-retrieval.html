<!-- 检索配置子页面 -->
<div class="bg-white/10 backdrop-blur-sm rounded-xl p-6">
    <div class="mb-6">
        <h2 class="text-xl font-bold text-white">检索配置</h2>
        <p class="text-gray-300">配置检索算法与相关参数</p>
    </div>

    <form>
        <!-- 检索基础设置 -->
        <div class="mb-8">
            <h3 class="text-lg font-medium text-white mb-4">基础检索设置</h3>
            <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                <div>
                    <label class="block text-sm font-medium text-gray-200 mb-1">检索算法</label>
                    <select class="w-full px-3 py-2 bg-white/20 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-white">
                        <option selected>向量相似度检索</option>
                        <option>混合检索 (向量+关键词)</option>
                        <option>分层检索</option>
                        <option>语义聚类检索</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-200 mb-1">检索最大结果数</label>
                    <input type="number" value="10" min="1" max="100" class="w-full px-3 py-2 bg-white/20 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-white">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-200 mb-1">最小相似度阈值</label>
                    <div class="flex items-center">
                        <input type="range" min="0" max="1" step="0.05" value="0.75" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        <span class="ml-2 text-sm text-gray-300 w-10">0.75</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-200 mb-1">检索超时时间 (毫秒)</label>
                    <input type="number" value="3000" min="500" max="30000" step="500" class="w-full px-3 py-2 bg-white/20 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-white">
                </div>
            </div>
        </div>

        <!-- 高级检索设置 -->
        <div class="mb-8">
            <h3 class="text-lg font-medium text-white mb-4">高级检索选项</h3>
            <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                <div>
                    <label class="block text-sm font-medium text-gray-200 mb-1">重排序方法</label>
                    <select class="w-full px-3 py-2 bg-white/20 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-white">
                        <option selected>不进行重排序</option>
                        <option>Cross-Encoder重排序</option>
                        <option>关键词加权重排序</option>
                        <option>时间衰减重排序</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-200 mb-1">重排序权重</label>
                    <div class="flex items-center">
                        <input type="range" min="0" max="1" step="0.1" value="0.5" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        <span class="ml-2 text-sm text-gray-300 w-10">0.5</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-200 mb-1">最大重排序数量</label>
                    <input type="number" value="50" min="1" max="200" class="w-full px-3 py-2 bg-white/20 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-white">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-200 mb-1">MMR多样性参数 (λ)</label>
                    <div class="flex items-center">
                        <input type="range" min="0" max="1" step="0.1" value="0.7" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        <span class="ml-2 text-sm text-gray-300 w-10">0.7</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 混合检索设置 -->
        <div class="mb-8">
            <h3 class="text-lg font-medium text-white mb-4">混合检索设置</h3>
            <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                <div>
                    <label class="block text-sm font-medium text-gray-200 mb-1">关键词检索引擎</label>
                    <select class="w-full px-3 py-2 bg-white/20 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-white">
                        <option selected>BM25</option>
                        <option>TF-IDF</option>
                        <option>ElasticSearch</option>
                        <option>不使用关键词检索</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-200 mb-1">向量检索权重</label>
                    <div class="flex items-center">
                        <input type="range" min="0" max="1" step="0.1" value="0.7" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        <span class="ml-2 text-sm text-gray-300 w-10">0.7</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-200 mb-1">关键词提取方法</label>
                    <select class="w-full px-3 py-2 bg-white/20 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-white">
                        <option selected>RAKE</option>
                        <option>TextRank</option>
                        <option>YAKE</option>
                        <option>KeyBERT</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-200 mb-1">关键词最大数量</label>
                    <input type="number" value="5" min="1" max="20" class="w-full px-3 py-2 bg-white/20 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-white">
                </div>
            </div>
        </div>

        <!-- 过滤条件设置 -->
        <div class="mb-8">
            <h3 class="text-lg font-medium text-white mb-4">元数据过滤设置</h3>
            <div class="space-y-4">
                <div class="flex items-center">
                    <input type="checkbox" id="enable-filter" checked class="w-4 h-4 rounded bg-white/20 border-gray-600">
                    <label for="enable-filter" class="ml-2 text-sm font-medium text-gray-200">启用元数据过滤</label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="filter-source" checked class="w-4 h-4 rounded bg-white/20 border-gray-600">
                    <label for="filter-source" class="ml-2 text-sm font-medium text-gray-200">允许按文档来源过滤</label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="filter-date" checked class="w-4 h-4 rounded bg-white/20 border-gray-600">
                    <label for="filter-date" class="ml-2 text-sm font-medium text-gray-200">允许按日期范围过滤</label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="filter-type" checked class="w-4 h-4 rounded bg-white/20 border-gray-600">
                    <label for="filter-type" class="ml-2 text-sm font-medium text-gray-200">允许按文档类型过滤</label>
                </div>
            </div>
        </div>

        <!-- 操作按钮 -->
        <div class="flex justify-end space-x-3">
            <button type="button" class="px-4 py-2 border border-gray-600 shadow-sm text-sm font-medium rounded-lg text-white bg-white/10 hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200">
                重置
            </button>
            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-lg text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200">
                保存设置
            </button>
        </div>
    </form>
</div>

<script>
    console.log('检索配置子页面已加载');
    
    // 确保页面元素已加载后才绑定事件
    setTimeout(() => {
        // 处理范围输入事件
        const rangeInputs = document.querySelectorAll('input[type="range"]');
        rangeInputs.forEach(input => {
            const output = input.nextElementSibling;
            // 设置初始值
            if (output) {
                output.textContent = input.value;
            }
            
            // 添加变化监听
            input.addEventListener('input', function() {
                if (output) {
                    output.textContent = this.value;
                }
                console.log(`范围滑块值变化: ${this.value}`);
            });
        });
        
        // 绑定表单提交事件
        const form = document.querySelector('form');
        if (form) {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('检索配置表单提交');
                alert('检索设置已保存');
            });
            console.log('表单提交事件已绑定');
        } else {
            console.error('未找到表单元素');
        }
        
        // 绑定重置按钮事件
        const resetButton = document.querySelector('button[type="button"]');
        if (resetButton) {
            resetButton.addEventListener('click', function() {
                console.log('点击了重置按钮');
                if (confirm('确定要重置所有检索设置吗？这将恢复默认值。')) {
                    document.querySelector('form').reset();
                    
                    // 重置后更新范围输入值显示
                    rangeInputs.forEach(input => {
                        const output = input.nextElementSibling;
                        if (output) {
                            output.textContent = input.value;
                        }
                    });
                    
                    alert('检索设置已重置为默认值');
                }
            });
            console.log('重置按钮事件已绑定');
        } else {
            console.error('未找到重置按钮');
        }
        
        console.log('检索配置子页面事件绑定完成');
    }, 100);
    
    // 响应settingsTabLoaded事件
    document.addEventListener('settingsTabLoaded', function(e) {
        if (e.detail.tab === 'retrieval') {
            console.log('检测到检索配置标签页已加载事件');
        }
    });
</script> 