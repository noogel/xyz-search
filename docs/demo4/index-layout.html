<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能检索平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .sidebar-active {
            background-color: #4F46E5;
        }
        
        /* 加载动画 */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #4F46E5;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- 侧边栏 -->
    <div class="flex">
        <div class="fixed inset-y-0 left-0 w-64 bg-indigo-800 text-white shadow-lg z-10">
            <div class="flex items-center justify-center h-16 bg-indigo-900">
                <i class="fas fa-robot text-2xl mr-2"></i>
                <span class="text-xl font-semibold">智能检索平台</span>
            </div>
            <nav class="mt-5">
                <a href="#" data-page="dashboard" class="nav-link flex items-center px-6 py-3 text-white hover:bg-indigo-700">
                    <i class="fas fa-tachometer-alt mr-3"></i>
                    <span>控制台</span>
                </a>
                <a href="#" data-page="knowledge" class="nav-link flex items-center px-6 py-3 text-white hover:bg-indigo-700">
                    <i class="fas fa-database mr-3"></i>
                    <span>知识库管理</span>
                </a>
                <a href="#" data-page="documents" class="nav-link flex items-center px-6 py-3 text-white hover:bg-indigo-700">
                    <i class="fas fa-file-alt mr-3"></i>
                    <span>文档管理</span>
                </a>
                <a href="#" data-page="chat" class="nav-link flex items-center px-6 py-3 text-white hover:bg-indigo-700">
                    <i class="fas fa-comments mr-3"></i>
                    <span>智能问答</span>
                </a>
                <a href="#" data-page="history" class="nav-link flex items-center px-6 py-3 text-white hover:bg-indigo-700">
                    <i class="fas fa-history mr-3"></i>
                    <span>对话历史</span>
                </a>
                <a href="#" data-page="settings" class="nav-link flex items-center px-6 py-3 text-white hover:bg-indigo-700">
                    <i class="fas fa-cog mr-3"></i>
                    <span>系统设置</span>
                </a>
                <a href="#" data-page="users" class="nav-link flex items-center px-6 py-3 text-white hover:bg-indigo-700">
                    <i class="fas fa-users mr-3"></i>
                    <span>用户管理</span>
                </a>
            </nav>
            <div class="absolute bottom-0 w-full">
                <div class="flex items-center px-6 py-3 hover:bg-indigo-700">
                    <i class="fas fa-question-circle mr-3"></i>
                    <span>帮助中心</span>
                </div>
                <a href="index.html" class="flex items-center px-6 py-3 hover:bg-indigo-700">
                    <i class="fas fa-sign-out-alt mr-3"></i>
                    <span>退出登录</span>
                </a>
            </div>
        </div>

        <!-- 主内容区 -->
        <div class="ml-64 flex-1">
            <!-- 顶部导航栏 -->
            <header class="bg-white shadow-sm">
                <div class="flex items-center justify-between h-16 px-8">
                    <h1 class="text-xl font-semibold text-gray-800" id="page-title">控制台</h1>
                    <div class="flex items-center">
                        <div class="relative mr-4">
                            <input type="text" placeholder="全局搜索..." class="pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        <div class="relative mr-4">
                            <i class="fas fa-bell text-gray-600 text-xl cursor-pointer"></i>
                            <span class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs">3</span>
                        </div>
                        <div class="flex items-center">
                            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="用户头像" class="w-8 h-8 rounded-full mr-2">
                            <span class="text-gray-700">管理员</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- 内容加载容器 -->
            <main class="p-8">
                <!-- 加载指示器 -->
                <div id="loading-indicator" class="flex justify-center items-center h-64 hidden">
                    <div class="loader"></div>
                </div>
                
                <!-- 内容将被异步加载到这里 -->
                <div id="content-container"></div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取页面元素
            const contentContainer = document.getElementById('content-container');
            const loadingIndicator = document.getElementById('loading-indicator');
            const pageTitle = document.getElementById('page-title');
            const navLinks = document.querySelectorAll('.nav-link');
            
            // 页面标题映射
            const pageTitles = {
                'dashboard': '控制台',
                'knowledge': '知识库管理',
                'documents': '文档管理',
                'chat': '智能问答',
                'history': '对话历史',
                'settings': '系统设置',
                'users': '用户管理'
            };
            
            // 加载页面函数
            function loadPage(url) {
                // 显示加载状态
                contentContainer.innerHTML = '';
                loadingIndicator.classList.remove('hidden');
                
                console.log('开始加载页面:', url);
                
                // 使用fetch获取HTML内容
                fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('加载失败');
                        }
                        return response.text();
                    })
                    .then(html => {
                        // 设置内容
                        contentContainer.innerHTML = html;
                        
                        // 隐藏加载指示器
                        loadingIndicator.classList.add('hidden');
                        
                        console.log('页面加载完成:', url);
                        
                        // 只对设置页面进行特殊处理
                        if (url.includes('settings-base.html')) {
                            console.log('检测到设置页面，准备初始化标签页');
                            // 确保DOM完全加载后再初始化标签页
                            setTimeout(() => {
                                // 定义一个内联版本的初始化函数作为备份
                                if (typeof window.initSettingsTabs !== 'function') {
                                    console.log('未找到全局initSettingsTabs函数，使用内联版本');
                                    window.initSettingsTabs = function() {
                                        console.log('使用内联版本的标签页初始化函数');
                                        const tabButtons = document.querySelectorAll('[id^="tab-"]');
                                        const panels = document.querySelectorAll('[id^="panel-"]');
                                        
                                        console.log('找到标签按钮数量:', tabButtons.length);
                                        console.log('找到面板数量:', panels.length);
                                        
                                        tabButtons.forEach(button => {
                                            button.addEventListener('click', () => {
                                                const tabId = button.id;
                                                const panelId = tabId.replace('tab-', 'panel-');
                                                
                                                panels.forEach(panel => {
                                                    panel.classList.add('hidden');
                                                });
                                                
                                                tabButtons.forEach(btn => {
                                                    btn.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
                                                    btn.classList.add('text-gray-600', 'hover:text-gray-800');
                                                });
                                                
                                                const targetPanel = document.getElementById(panelId);
                                                if(targetPanel) {
                                                    targetPanel.classList.remove('hidden');
                                                } else {
                                                    console.error('找不到目标面板:', panelId);
                                                }
                                                
                                                button.classList.remove('text-gray-600', 'hover:text-gray-800');
                                                button.classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');
                                            });
                                        });
                                        
                                        if(tabButtons.length > 0) {
                                            tabButtons[0].click();
                                        }
                                    };
                                }
                                
                                // 执行初始化
                                try {
                                    console.log('正在调用initSettingsTabs函数...');
                                    window.initSettingsTabs();
                                    console.log('标签页初始化成功');
                                } catch (error) {
                                    console.error('标签页初始化失败:', error);
                                }
                            }, 300); // 增加延迟确保DOM完全渲染
                        }
                        
                        // 更新浏览器历史记录
                        const pageName = url.split('-')[0];
                        history.pushState({page: url}, '', `?page=${pageName}`);
                    })
                    .catch(error => {
                        console.error('页面加载失败:', error);
                        loadingIndicator.classList.add('hidden');
                        contentContainer.innerHTML = `
                            <div class="flex flex-col items-center justify-center h-full">
                                <div class="text-red-500 text-xl mb-4">加载失败</div>
                                <div class="text-gray-600 mb-4">${error.message}</div>
                                <button onclick="loadPage('${url}')" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors">重试</button>
                            </div>
                        `;
                    });
            }
            
            // 设置导航链接点击事件
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    
                    // 设置活动导航项
                    navLinks.forEach(nav => {
                        nav.classList.remove('sidebar-active');
                    });
                    this.classList.add('sidebar-active');
                    
                    // 更新页面标题
                    pageTitle.textContent = pageTitles[page] || '控制台';
                    
                    // 加载页面内容
                    loadPage(`${page}-base.html`);
                });
            });
            
            // 处理浏览器导航
            window.addEventListener('popstate', function(e) {
                const page = e.state ? e.state.page : 'dashboard-base.html';
                loadPage(page);
            });
            
            // 初始加载
            const urlParams = new URLSearchParams(window.location.search);
            const initialPage = urlParams.get('page') || 'dashboard';
            const pagePath = `${initialPage}-base.html`;
            loadPage(pagePath);
            
            // 初始设置活动导航项
            const activeLink = document.querySelector(`.nav-link[data-page="${initialPage}"]`);
            if (activeLink) {
                activeLink.classList.add('sidebar-active');
            }
            
            // 设置页面标题
            pageTitle.textContent = pageTitles[initialPage] || '控制台';
        });
    </script>
</body>
</html> 